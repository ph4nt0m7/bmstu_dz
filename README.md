ДЗ
=============================

Файлы
------------
1) **main.c** – в нем содержится  `int main()`, с которого начинается работа. В ней идет вход в учетку (подключается в файл *users.csv*) и у кого какие права (если есть права на оба - то предоставляется выбор), в такое меню входит
2) **header.h** – в этом файле записаны:
    * библиотеки, которые использует программа;
    * define'ы / настройки программы;
    * объявление всех функций из всех файлов и написание их прототипов.
    * объявление структур хранение информации для книг и студентов.
3) **books.c** – в этом файле содержится вся работа с книгами, которую мне было необходимо реализовать согласно моему варианту
4) **students.c** – в этом файле содержится вся работа со студентами, которую мне было необходимо реализовать согласно моему варианту
5) **functions.c** – в данном файле содержатся доп. функции
5) **log.c** – в данном файле функции для логирования

#Define'ы
------------
CSV директории

      books_csv           -- default: "csv/books.csv"
                             Директория для файла с книгами
      users_csv           -- default:"csv/users.csv"
                             Директория для файла с пользователями
      student_books_csv   -- default:"csv/student_books.csv"
                             Директория для файла со взятыми книгами
      students_csv        -- default:"csv/students.csv"
                             Директория для файла со студентами

Другие директории

      log_file            -- default: "library.log"
                             Директория для лог-файла
      backup_derictory    -- default: "_backups/"
                             Директория, где лежат бэкапы и куда они будут сохраняться
Настройки логирования
      
      log_write           -- default: 1
                             Параметр для включения логирования (1 для вкл, 0 для выкл)
      log_params          -- default: 1
                             Параметр для включения параметров (1 для вкл, 0 для выкл)

Настройки логирования сообщений ("сообщение" для включения, NULL для выключения)

      log_before_start    -- default: "BeforeStart"
                             Сообщение начала старта программы
      log_login           -- default: "StartSystem"
                             Сообщение о входе
      log_login_failed    -- default: "loginFailed"
                             Сообщение о неудачном входе
      log_shutdown        -- default: "ShutdownSystem"
                             Сообщение о выходе
      log_enter_books     -- default: "EnterBooks"
                             Сообщение о входе в систему книг
      log_enter_students  -- default: "EnterStudents"
                             Сообщение о входе в систему студентов
      log_cant_open_file  -- default: "CantOpenFile"
                             Сообщение об отсутствии файла (в параметрах указан путь файла)
      log_dup_ISBN        -- default: "IsbnDuplication"
                             Сообщение о повторении ISBN книги
      log_EOF_detected    -- default: "EOFDetected"
                             Сообщение о получении от пользователя ввода Ctrl^D или другую EOF команду
                             
Цветовое оформление консольного вывода + Цветные сообщения

      COLOR_CLEAR         -- "\x1b[0m"
                             Удаление цвета 
      COLOR_RED           -- "\x1b[31m"
                             Цвет: красный
      COLOR_CYAN          -- "\x1b[36m"
                             Цвет: циан
      COLOR_YELLOW        -- "\x1b[33m"
                             Цвет: желтый
      COLOR_BOLD          -- "\x1b[1m"
                             Жирный текст
      ERROR               -- "[\x1b[1m\x1b[31mERROR\x1b[0m]"
                             Сообщение: Ошибка
      WARNING             -- "[\x1b[1m\x1b[33mWARNING\x1b[0m]"
                             Сообщение: Предупреждение
      INFO                -- "[\x1b[1m\x1b[36mINFO\x1b[0m]"
                             Сообщение: Инфо
            
Функции файла "books.c" 
------------
* **Структура хранения книг:**
```c
struct Book{
    unsigned long long ISBN;
    char Author[128];
    char Name[128];
    int  NumAll;
    int  NumUsed;
};
```
* **Вход в меню книг:** в данной функции реализовано загрузка из файла в структуру данных, подсчет строк в `LineCount` и выбор действий
```C
void Books_start(void);
```

* **Выход из меню книг:** в данной функции реализовано сохранение из структуры в файл данных
```C
void Books_exit (struct Book *Books, int LineCount);
```

* **Добавление книг:** в данной функции реализовано добавление книги. Если такой ISBN существует, то пользователю предлагается ввести его заново
```C
struct Book* Books_add(struct Book *Books, int LineCount);
```

* **Удаление книг:** в данной функции реализовано удаление книги. Если эта книга на руках у какого-то студента, программа не дает ее удалить
```C
void Books_delete(struct Book *Books, int LineCount);
```

* **Показ всех книг:** в данной функции реализован показ всех книг из библиотеки с сортировкой (использован алгоритм [быстрой сортировки](https://ru.wikipedia.org/wiki/Быстрая_сортировка))
```C
void Books_showall(struct Book *Books, int LineCount);
```

* **Поиск книги:** в данной функции реализован показ всей информации книги. Для поиска нужно знать ISBN
```C
void Books_find(struct Book *Books, int LineCount);
```

* **У каких студентов эта кина:** в данной функции реализован показ студентов и их информация по определенной книге (по ISBN), которую они взяли
```C
void Books_onhands(FILE *BookFile, struct Book *Books, int LineCount);
```

Функции файла "students.c" 
------------
* **Структура хранения информации студента:**
```c
struct Student{
    char RecBook[10];
    char Name[32];
    char SName[32];
    char OName[32];
    char Faculty[10];
    char Spec[1024];
};
```
* **Вход в меню студента:** в данной функции реализовано загрузка из файла в структуру данных, подсчет строк в `LineCount` и выбор действий
```C
void Students_start(void);
```

* **Выход из меню студента:** в данной функции реализовано сохранение из структуры в файл данных
```C
void Students_exit(struct Student *Students, int LineCount);
```

* **Добавление студента:** в данной функции реализовано добавление студента. Если такая зачетка существует, то пользователю предлагается ввести ее заново
```C
struct Student* Students_add(struct Student *Students, int LineCount);
```

* **Удаление студента:** в данной функции реализовано удаление студента. Если он не сдал все книги, программа не дает его удалить
```C
void Students_delete(struct Student *Students, int LineCount);
```

* **Сделать бэкап файла со студентами:** в данной функции реализован механизм создание бэкапа и добавление в название файла дату создания
```C
void Students_backup_save(struct Student *Students, int LineCount);
```

* **Восстановить из бэкапа информацию студентов:** в данной функции реализован механизм восстановление информации студентов из бэкапа. Так же есть проверка на ввод пути файла, есть 2-я проверка файла вне директории бэкапа. Если система не может открыть или найти файл, пользователю выводит информацию о потенциальных бэкап-файлах
```C
struct Student* Students_backup_upload(struct Student *Students, int LineCount, FILE *StudentsFile);
```

* **Поиск студента:** в данной функции реализован поиск студента и вывод его информации
```C
void Students_search(struct Student *Students, int LineCount);
```

* **Показ книг у студента:** в данной функции реализован показ книг, которые взял студент. Поиск студента осуществляется по студ. книжке
```C
void Students_showall(struct Student *Students, int LineCount);
```

Функции файла "functions.c" 
------------
* **Аналог функции `scanf("%s")`**
```C
char *scan(char EndSymb);
```

* **Вывод текста - предупреждения**
```C
void p_warn(char text[]);
```

* **Вывод текста - ошибки**
```C
void p_err(char text[]);
```

* **Вывод текста - информации**
```C
void p_info(char text[]);
```

* **Проверка на открытый файл:** открыт ли файл или нет, если нет - то запись в лог-файл об этом с детальной информацией
```C
void check_fopen(FILE *test_file, char filename[]);
```

* **Функция уведомления:** Данная функция позволяет детально уведомить пользователя, записать при необходимости информацию в лог-файл и необходимые параметры и/или завершить экстренно работу. Так же есть информация [по ошибкам](#EXITcodes)
```C
void notify(char mode[], char text[], int exitcode, char *params, _Bool silent);
```

* **Начальная проверка файлов:** Если нет какого то из фалов - программа не запускается, уведомляет пользователя об отсутствии и записывается информация в лог-файл
```C
void checkfile(void);
```

* **Сортировка - свап-функция:** необходима для *быстрой сортировки*
```C
void swap(struct Book *a, struct Book *b);
```

* **Сортировка - алгоритм быстрой сортировки**
```C
void quick_sort_struct_book_by_isbn(struct Book *Books, int left, int right);
```

Функции файла "log.c" 
------------
* **Запись глобальной переменной `_Bool write_log` в файле *log.c***
```C
void write_log_act(_Bool do_write_log);
```

* **Запись глобальной переменной `char User[]` в файле *log.c*** 
```C
void setup_user(char user[]);
```

* **Запись строк в лог-файл:** в данной функции реализовано построчная запись в лог-файл любых записей с параметрами, настройку которых вы можете найти выше выше
```C
void add_log(char activity[], char params[]);
```

Запуск и использование
------------
* **Запуск через make**: make
* **Запуск через компилятор *clang***: clang ./main.c ./books.c ./header.h ./functions.c ./students.c ./log.c -lm; ./a.out; rm ./a.out; clear;
* **Запуск через компилятор *gcc***: gcc ./main.c ./books.c ./header.h ./functions.c ./students.c ./log.c -lm; ./a.out; rm ./a.out; clear;
*Программа предназначена для использования на clang компиляторе. При использовании другого компилятора исправить в Makefile в строке №2 "clang" на свой.*


<a name="EXITcodes">EXIT Коды</a>
------------
* 1-я цифра:
    * 1: из main()
    * 2: из books.c
    * 3: из students.c
    * 4: из log.c
    * 5: из function.c
    * 9: остальное
* 2-я цифра:
    * 0: критическое неопределенное
    * 1: не предсказанная логика
    * 2: доступ к файлу
    * 3: синтаксис файла
    * 3: ОЗУ
    * 4: переменные
    * 9: непредвиденная

